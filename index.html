<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novellium</title>
    <link rel="icon" type="image/png" href="assets/images/app-icon.png">
    <appversion hidden="0.1.0"></appversion>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        novellium: {
                            bg: '#1a0b2e',
                            cyan: '#00f2ff',
                            amber: '#ffd700',
                            glass: 'rgba(255, 255, 255, 0.05)',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        serif: ['Lora', 'serif'],
                    },
                    boxShadow: {
                        'glow-cyan': '0 0 20px rgba(0, 242, 255, 0.5)',
                        'glow-amber': '0 0 20px rgba(255, 215, 0, 0.5)',
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Lora:ital,wght@0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #1a0b2e;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(0, 242, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 215, 0, 0.05) 0%, transparent 20%);
            color: #e2e8f0;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(0, 242, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .text-glow {
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
        }
    </style>
</head>

<body class="antialiased overflow-x-hidden">

    <!-- Hero Section -->
    <header class="min-h-screen flex flex-col justify-center items-center relative overflow-hidden px-4 text-center">
        <!-- Floating Elements Animation (Simplified CSS) -->
        <div class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-20">
            <div
                class="absolute top-1/4 left-1/4 w-64 h-64 bg-novellium-cyan rounded-full mix-blend-screen filter blur-[100px] animate-pulse">
            </div>
            <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600 rounded-full mix-blend-screen filter blur-[120px] animate-pulse"
                style="animation-delay: 2s;"></div>
        </div>

        <div class="z-10 max-w-4xl mx-auto flex flex-col items-center gap-4">
            <div
                class="w-32 h-32 md:w-48 md:h-48 relative mb-4 glow-cyan rounded-2xl overflow-hidden glass-card flex items-center justify-center">
                <!-- App Icon -->
                <img src="assets/images/app-icon.png" alt="Novellium App Icon" class="w-full h-full object-cover">
            </div>

            <h1 class="font-display text-5xl md:text-7xl font-bold tracking-tight mb-2">
                <span class="text-novellium-cyan text-glow">Novellium</span>
                <br>
                <span class="text-novellium-amber text-glow">The Narrative Engine</span>
            </h1>

            <p class="font-serif text-xl md:text-2xl text-gray-300 max-w-2xl leading-relaxed">
                A fully portable, context-aware AI writing studio. No install, no cloud, no limits, all in a single
                <span class="text-white font-semibold">10MB executable.</span><br>
                <span class="text-novellium-amber text-glow"><i>Private and Free, Forever.</i></span>
            </p>

            <div class="mt-8">
                <a href="releases/Novellium.exe"
                    class="group relative inline-flex items-center gap-3 px-8 py-4 bg-novellium-cyan text-black font-display font-bold text-lg rounded-full shadow-glow-cyan transition-all hover:scale-105 hover:bg-white">
                    <span>Download Novellium v0.1.0 (Under Construction)</span>
                    <i class="fa-solid fa-download group-hover:animate-bounce"></i>
                </a>
                <p class="mt-4 text-sm text-gray-400">Windows x64 • SHA-256 Verified</p>
            </div>

            <div class="mt-8">
                <a href="demo.html"
                    class="group relative inline-flex items-center gap-3 px-8 py-4 bg-novellium-cyan text-black font-display font-bold text-lg rounded-full shadow-glow-cyan transition-all hover:scale-105 hover:bg-white">
                    <span>Try the Interactive Web Demo here!</span>
                </a>
            </div>
        </div>

        <!-- Scroll Indicator -->
        <div class="absolute bottom-4 left-9/20 transform -translate-x-1/2 animate-bounce">
            <i class="fa-solid fa-chevron-down text-novellium-cyan text-2xl opacity-50"></i>
        </div>
    </header>

    <!-- The Impossible Specs Strip -->
    <section class="border-y border-white/10 bg-black/20 backdrop-blur-md py-6">
        <div class="container mx-auto px-4">
            <div
                class="flex flex-wrap justify-center md:justify-between items-center gap-6 md:gap-12 text-gray-300 font-display text-sm md:text-base uppercase tracking-widest">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-eye-slash text-novellium-cyan"></i>
                    <span>Zero Telemetry</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-infinity text-novellium-cyan"></i>
                    <span>Infinite Memory</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-layer-group text-novellium-cyan"></i>
                    <span>Model Agnostic</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-ethernet text-novellium-cyan"></i>
                    <span>MCP Integration</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Feature Grid -->
    <section class="py-24 relative">
        <div class="container mx-auto px-4">
            <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-16">
                <span class="border-b-2 border-novellium-cyan pb-2">Augmented</span> Creativity
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
                <!-- Card 1 -->
                <div class="glass-card p-8 rounded-3xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity">
                        <i class="fa-solid fa-brain text-8xl text-novellium-cyan"></i>
                    </div>
                    <div class="relative z-10">
                        <h3 class="font-display text-2xl font-bold mb-4 text-novellium-cyan">Active Context Retrieval
                        </h3>
                        <p class="font-serif text-gray-300 leading-relaxed">
                            Hybrid Aspect Taxonomy + AI pre-prompt relevance. The app remembers your story
                            details—characters, locations, and lore—so you don't have to constantly remind it.
                        </p>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="glass-card p-8 rounded-3xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity">
                        <i class="fa-solid fa-pen-nib text-8xl text-novellium-amber"></i>
                    </div>
                    <div class="relative z-10">
                        <h3 class="font-display text-2xl font-bold mb-4 text-novellium-amber">Self-Updating Lore</h3>
                        <p class="font-serif text-gray-300 leading-relaxed">
                            As you write, Novellium can automatically create and update context cards, tracking
                            character
                            changes and plot developments for you.
                        </p>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="glass-card p-8 rounded-3xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity">
                        <i class="fa-solid fa-timeline text-8xl text-pink-500"></i>
                    </div>
                    <div class="relative z-10">
                        <h3 class="font-display text-2xl font-bold mb-4 text-pink-400">Interactive Timeline</h3>
                        <p class="font-serif text-gray-300 leading-relaxed">
                            Visualize your narrative flow with a fully interactive timeline generator. Drag-and-drop
                            events to restructure your plot instantly.
                        </p>
                    </div>
                </div>

                <!-- Card 4 -->
                <div class="glass-card p-8 rounded-3xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity">
                        <i class="fa-solid fa-share-nodes text-8xl text-green-400"></i>
                    </div>
                    <div class="relative z-10">
                        <h3 class="font-display text-2xl font-bold mb-4 text-green-400">Local & External Integrations
                        </h3>
                        <p class="font-serif text-gray-300 leading-relaxed">
                            Connect to external APIs, local LLMs (Ollama), and image generators for storyboarding, comic
                            strip creation, and infinite extensibility.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Experience Section -->
    <section class="py-24 bg-black/30 overflow-hidden">
        <div class="container mx-auto px-4 text-center">
            <h2 class="font-display text-3xl md:text-5xl font-bold mb-6">A Sanctuary for Your Words</h2>
            <p class="font-serif text-xl text-gray-400 max-w-2xl mx-auto mb-12">
                With dozens of app themes, adjustable UI, and multiple built-in sound sets, Novellium aims to provide a
                comfortable environment for you to create your stories.
            </p>

            <!-- 3D Carousel Viewport -->
            <div id="carousel-viewport"
                class="relative max-w-6xl mx-auto h-[500px] flex items-center justify-center perspective-[1000px]">

                <!-- Controls Overlay (Z-Index High) -->
                <div
                    class="absolute top-0 left-0 w-full h-full z-50 pointer-events-none flex justify-between items-center px-4 md:px-12">
                    <button id="prev-theme"
                        class="pointer-events-auto w-12 h-12 rounded-full bg-black/50 backdrop-blur-md text-white/50 hover:text-novellium-cyan hover:bg-black/80 transition-all flex items-center justify-center border border-white/10 z-50">
                        <i class="fa-solid fa-chevron-left text-xl"></i>
                    </button>
                    <button id="next-theme"
                        class="pointer-events-auto w-12 h-12 rounded-full bg-black/50 backdrop-blur-md text-white/50 hover:text-novellium-cyan hover:bg-black/80 transition-all flex items-center justify-center border border-white/10 z-50">
                        <i class="fa-solid fa-chevron-right text-xl"></i>
                    </button>
                </div>

                <!-- Theme Name Display (Top Center) -->
                <div
                    class="absolute top-4 left-1/2 transform -translate-x-1/2 z-50 bg-black/40 backdrop-blur-md px-6 py-2 rounded-full border border-white/10">
                    <span id="theme-name"
                        class="font-display font-bold text-sm uppercase tracking-widest text-white/80">Deep Space</span>
                </div>

                <!-- Sound Controls (Bottom Center) -->
                <div
                    class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-50 bg-black/60 backdrop-blur-xl px-4 py-2 rounded-full border border-white/10 flex items-center gap-3 pointer-events-auto transition-all hover:bg-black/80 hover:border-novellium-cyan/50 shadow-lg">
                    <i class="fa-solid fa-volume-high text-novellium-cyan text-sm opacity-50 transition-opacity"></i>
                    <div class="relative">
                        <select id="sound-pack-select"
                            class="appearance-none bg-transparent text-xs text-white/90 font-mono font-bold uppercase tracking-wider outline-none cursor-pointer pr-6 py-1 border-none focus:ring-0">
                            <option value="typewriter" class="bg-gray-900 text-white">Typewriter</option>
                            <option value="keyboard" class="bg-gray-900 text-white">Mech Keyboard</option>
                            <option value="pencil" class="bg-gray-900 text-white">Pencil</option>
                            <option value="pen" class="bg-gray-900 text-white">Pen</option>
                            <option value="scissorswitch_keyboard" class="bg-gray-900 text-white">Laptop</option>
                        </select>
                        <i
                            class="fa-solid fa-chevron-down absolute right-0 top-1/2 transform -translate-y-1/2 text-[10px] text-white/50 pointer-events-none"></i>
                    </div>
                </div>

                <!-- Carousel Track -->
                <div id="carousel-track" class="relative w-full h-full flex items-center justify-center preserve-3d">
                    <!-- Cards will be injected by JS -->
                </div>

            </div>
        </div>
    </section>

    <!-- Dynamic Sound Manifest -->
    <script src="assets/sound_manifest.js"></script>

    <!-- Interactive Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Theme Data ---
            const themes = [
                { name: 'Light', bg: '#ffffff', text: '#111827', surface: '#f9fafb', primary: '#6366f1', secondary: '#8b5cf6', border: '#e5e7eb', font: 'font-serif' },
                { name: 'Dark', bg: '#111827', text: '#f9fafb', surface: '#1f2937', primary: '#818cf8', secondary: '#a78bfa', border: '#374151', font: 'font-serif' },
                { name: 'Purple', bg: '#0d0015', text: '#f5f3ff', surface: '#1a0a2e', primary: '#a855f7', secondary: '#ec4899', border: '#3b2066', font: 'font-serif' },
                { name: 'Ocean', bg: '#0f172a', text: '#f1f5f9', surface: '#1e293b', primary: '#06b6d4', secondary: '#3b82f6', border: '#334155', font: 'font-serif' },
                { name: 'Emerald', bg: '#071512', text: '#f0fdf4', surface: '#0f2920', primary: '#4ade80', secondary: '#fbbf24', border: '#14532d', font: 'font-serif' },
                { name: 'Mint', bg: '#0f1b1e', text: '#f0fdfa', surface: '#162328', primary: '#2dd4bf', secondary: '#38bdf8', border: '#1e3a3a', font: 'font-serif' },
                { name: 'Forest', bg: '#1a1814', text: '#e8e4d9', surface: '#2a2820', primary: '#8fbc8f', secondary: '#d4a574', border: '#3d3a30', font: 'font-serif' },
                { name: 'Parchment', bg: '#f5f0e1', text: '#3d3225', surface: '#ebe6d5', primary: '#8b4513', secondary: '#b22222', border: '#d4c9b0', font: 'font-serif' },
                { name: 'Sepia', bg: '#f4ecd8', text: '#3d3225', surface: '#e8dfc8', primary: '#5c4033', secondary: '#8b6914', border: '#c9bea6', font: 'font-serif' },
                { name: 'Nightshade', bg: '#282a36', text: '#f8f8f2', surface: '#383a4a', primary: '#bd93f9', secondary: '#ff79c6', border: '#44475a', font: 'font-serif' },
                { name: 'Nord', bg: '#2e3440', text: '#eceff4', surface: '#3b4252', primary: '#88c0d0', secondary: '#81a1c1', border: '#4c566a', font: 'font-serif' },
                { name: 'Monokai', bg: '#272822', text: '#f8f8f2', surface: '#3e3d32', primary: '#f92672', secondary: '#a6e22e', border: '#49483e', font: 'font-serif' },
                { name: 'Gruvbox', bg: '#282828', text: '#ebdbb2', surface: '#3c3836', primary: '#fabd2f', secondary: '#fe8019', border: '#504945', font: 'font-serif' },
                { name: 'Rose Pine', bg: '#191724', text: '#e0def4', surface: '#1f1d2e', primary: '#ebbcba', secondary: '#c4a7e7', border: '#26233a', font: 'font-serif' },
                { name: 'Tokyo Night', bg: '#1a1b26', text: '#c0caf5', surface: '#24283b', primary: '#7aa2f7', secondary: '#bb9af7', border: '#414868', font: 'font-serif' },
                { name: 'Cobalt', bg: '#002240', text: '#ffffff', surface: '#003366', primary: '#0088ff', secondary: '#ff9d00', border: '#004488', font: 'font-serif' },
                { name: 'Solarized', bg: '#002b36', text: '#839496', surface: '#073642', primary: '#268bd2', secondary: '#2aa198', border: '#073642', font: 'font-serif' },
                { name: 'Catppuccin', bg: '#1e1e2e', text: '#cdd6f4', surface: '#313244', primary: '#cba6f7', secondary: '#f5c2e7', border: '#45475a', font: 'font-serif' },
                { name: 'Spartan', bg: '#0d1210', text: '#e2e8e4', surface: '#1a2420', primary: '#5d7c64', secondary: '#d4af37', border: '#2c3a32', font: 'font-serif' },
                { name: 'Night City', bg: '#050505', text: '#e0e0e0', surface: '#121212', primary: '#fcee0a', secondary: '#00f0ff', border: '#fcee0a', font: 'font-serif' },
                { name: 'Dragonborn', bg: '#141414', text: '#e8e8e8', surface: '#1f2124', primary: '#77b8c8', secondary: '#ffffff', border: '#40444b', font: 'font-serif' },
                { name: 'System', bg: '#020502', text: '#b0f0b0', surface: '#051005', primary: '#008f11', secondary: '#003b00', border: '#003b00', font: 'font-mono' },
                { name: 'Wasteland', bg: '#080a08', text: '#ceffce', surface: '#0f180f', primary: '#1aff80', secondary: '#114224', border: '#114224', font: 'font-mono' },
                { name: 'Commander', bg: '#0b0c10', text: '#f0f0f0', surface: '#1a1a1d', primary: '#c41e3a', secondary: '#ffffff', border: '#45a29e', font: 'font-serif' },
                { name: 'Budapest', bg: '#FFF0F5', text: '#510056', surface: '#FFD7E6', primary: '#784283', secondary: '#F2A478', border: '#de83b2', font: 'font-serif' },
                { name: 'Arrakis', bg: '#F3E5AB', text: '#3D2B1F', surface: '#E6D690', primary: '#C06C47', secondary: '#4A6D7C', border: '#d4c4a8', font: 'font-serif' },
                { name: 'Shire', bg: '#F9FDF5', text: '#2F3A23', surface: '#ECF5E1', primary: '#4C7031', secondary: '#E6C229', border: '#cddbc4', font: 'font-serif' },
                { name: 'Gatsby', bg: '#FAF9F6', text: '#1A1A1A', surface: '#F0EEE6', primary: '#D4AF37', secondary: '#000000', border: '#D4AF37', font: 'font-serif' },
                { name: 'Her', bg: '#FFF5EE', text: '#4A2C2A', surface: '#FDE4D8', primary: '#D93B28', secondary: '#E8927C', border: '#f2d1c9', font: 'font-serif' },
                { name: 'Totoro', bg: '#F7EEE9', text: '#4A5D6A', surface: '#E8F6F6', primary: '#5D8CAE', secondary: '#A6D784', border: '#d1dede', font: 'font-serif' }
            ];

            let currentIndex = 0;
            const track = document.getElementById('carousel-track');
            const themeNameDisplay = document.getElementById('theme-name');
            const soundSelect = document.getElementById('sound-pack-select');
            let activeTextarea = null; // Reference to the currently active textarea

            // Mobile detection
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            // Audio system state
            let audioUnlocked = false;
            let audioPool = {}; // Pool of pre-loaded audio objects
            const POOL_SIZE = 5; // Number of audio objects per sound
            let previousTextareaValue = ''; // Track previous value for mobile input detection

            // Initialize audio context (required for mobile)
            const unlockAudio = () => {
                if (audioUnlocked) return;

                // Create a dummy audio and try to play it
                const silentAudio = new Audio();
                silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA';
                silentAudio.play().then(() => {
                    audioUnlocked = true;
                    preloadAllSounds();
                    updateAudioIndicator(true);
                }).catch(() => {
                    console.warn('Audio unlock failed, will retry on next interaction');
                });
            };

            // Pre-load audio files into pool
            const preloadAllSounds = () => {
                if (!audioUnlocked || typeof SOUND_MANIFEST === 'undefined') return;

                const pack = soundSelect.value;
                const config = SOUND_MANIFEST[pack];
                if (!config) return;

                // Clear existing pool for this pack
                audioPool[pack] = { standard: [], space: [], enter: [] };

                // Pre-load standard sounds
                const allStandard = config.standard || [];
                if (allStandard.length > 0) {
                    for (let i = 0; i < Math.min(POOL_SIZE, allStandard.length); i++) {
                        const audio = new Audio();
                        audio.src = `assets/sounds/${pack}/${allStandard[i % allStandard.length]}`;
                        audio.volume = 0.5;
                        audio.preload = 'auto';
                        audioPool[pack].standard.push(audio);
                    }
                }

                // Pre-load space sounds
                const allSpace = config.space || [];
                if (allSpace.length > 0) {
                    for (let i = 0; i < Math.min(POOL_SIZE, allSpace.length); i++) {
                        const audio = new Audio();
                        audio.src = `assets/sounds/${pack}/${allSpace[i % allSpace.length]}`;
                        audio.volume = 0.5;
                        audio.preload = 'auto';
                        audioPool[pack].space.push(audio);
                    }
                }

                // Pre-load enter sounds
                const allEnter = config.enter || [];
                if (allEnter.length > 0) {
                    for (let i = 0; i < Math.min(POOL_SIZE, allEnter.length); i++) {
                        const audio = new Audio();
                        audio.src = `assets/sounds/${pack}/${allEnter[i % allEnter.length]}`;
                        audio.volume = 0.5;
                        audio.preload = 'auto';
                        audioPool[pack].enter.push(audio);
                    }
                }
            };

            // Update audio indicator visual feedback
            const updateAudioIndicator = (enabled) => {
                const indicator = document.getElementById('sound-pack-select');
                const icon = document.querySelector('.fa-volume-high');
                if (enabled) {
                    if (icon) icon.classList.remove('opacity-50');
                } else {
                    if (icon) icon.classList.add('opacity-50');
                }
            };

            function renderCarousel() {
                track.innerHTML = ''; // Clear current

                // Calculate indices
                const prevIndex = (currentIndex - 1 + themes.length) % themes.length;
                const nextIndex = (currentIndex + 1) % themes.length;

                // Helper to create card
                const createCard = (index, position) => {
                    const theme = themes[index];
                    const card = document.createElement('div');

                    let classes = "absolute w-[600px] h-[350px] rounded-2xl shadow-2xl overflow-hidden transition-all duration-500 ease-out border border-white/5 flex flex-col";
                    let zIndex = 0;
                    let transform = "";
                    let opacity = "1";
                    let pointerEvents = "pointer-events-none";

                    if (position === 'center') {
                        zIndex = 30;
                        transform = "scale(0.85) translateX(0) translateZ(0)";
                        opacity = "1";
                        pointerEvents = "pointer-events-auto";
                        classes += " shadow-glow-cyan";
                    } else if (position === 'left') {
                        zIndex = 10;
                        transform = "scale(0.65) translateX(-65%) translateZ(-100px) rotateY(15deg)";
                        opacity = "0.4";
                    } else if (position === 'right') {
                        zIndex = 10;
                        transform = "scale(0.65) translateX(65%) translateZ(-100px) rotateY(-15deg)";
                        opacity = "0.4";
                    }

                    card.className = classes;
                    card.style.zIndex = zIndex;
                    card.style.transform = transform;
                    card.style.opacity = opacity;
                    card.style.pointerEvents = pointerEvents;

                    // Main Background
                    card.style.backgroundColor = theme.bg;

                    if (position === 'center') {
                        // MINI APP UI LAYOUT
                        const appContainer = document.createElement('div');
                        appContainer.className = "w-full h-full flex overflow-hidden";

                        // 1. Sidebar (Left)
                        const sidebar = document.createElement('div');
                        sidebar.className = "w-1/4 h-full flex flex-col p-4 gap-3";
                        sidebar.style.backgroundColor = theme.surface;
                        sidebar.style.borderRight = `1px solid ${theme.border}`;

                        // Fake Sidebar Items
                        const sidebarItem1 = document.createElement('div');
                        sidebarItem1.className = "w-3/4 h-3 rounded opacity-50";
                        sidebarItem1.style.backgroundColor = theme.text;

                        const sidebarItem2 = document.createElement('div');
                        sidebarItem2.className = "w-1/2 h-3 rounded opacity-30";
                        sidebarItem2.style.backgroundColor = theme.text;

                        const sidebarItem3 = document.createElement('div');
                        sidebarItem3.className = "w-2/3 h-3 rounded opacity-30";
                        sidebarItem3.style.backgroundColor = theme.text;

                        const sidebarActiveItem = document.createElement('div');
                        sidebarActiveItem.className = "w-full h-8 rounded mt-4 flex items-center px-2";
                        sidebarActiveItem.style.backgroundColor = `${theme.primary}20`; // 20 hex = low opacity
                        sidebarActiveItem.style.borderLeft = `3px solid ${theme.primary}`;

                        const activeItemText = document.createElement('div');
                        activeItemText.className = "w-1/2 h-2 rounded";
                        activeItemText.style.backgroundColor = theme.primary;

                        sidebarActiveItem.appendChild(activeItemText);

                        sidebar.appendChild(sidebarItem1);
                        sidebar.appendChild(sidebarItem2);
                        sidebar.appendChild(sidebarItem3);
                        sidebar.appendChild(sidebarActiveItem);


                        // 2. Main Content Area (Right)
                        const mainContent = document.createElement('div');
                        mainContent.className = "flex-1 h-full flex flex-col relative";

                        // Header
                        const header = document.createElement('div');
                        header.className = "w-full h-12 flex items-center justify-between px-6";
                        header.style.borderBottom = `1px solid ${theme.border}`;

                        const breadcrumb = document.createElement('div');
                        breadcrumb.className = "w-1/3 h-3 rounded opacity-60";
                        breadcrumb.style.backgroundColor = theme.text;

                        const actionBtn = document.createElement('div');
                        actionBtn.className = "w-8 h-8 rounded-full";
                        actionBtn.style.backgroundColor = theme.primary;

                        header.appendChild(breadcrumb);
                        header.appendChild(actionBtn);

                        // Editor Area (Textarea Parent)
                        const editorContainer = document.createElement('div');
                        editorContainer.className = "flex-1 w-full relative p-6 overflow-hidden flex flex-col";

                        // Metadata Line (Date/Words)
                        const metaLine = document.createElement('div');
                        metaLine.className = "flex gap-2 mb-4 opacity-40";
                        for (let i = 0; i < 3; i++) {
                            const pill = document.createElement('div');
                            pill.className = "w-16 h-2 rounded";
                            pill.style.backgroundColor = theme.text;
                            metaLine.appendChild(pill);
                        }

                        // Actual Interactive Textarea
                        const area = document.createElement('textarea');
                        area.className = `w-full flex-1 bg-transparent border-none resize-none outline-none ${theme.font} text-2xl md:text-3xl leading-relaxed transition-colors duration-300 placeholder-current placeholder-opacity-25`;
                        area.style.color = theme.text;
                        area.placeholder = "Start writing...";
                        area.maxLength = 100; // Increased for layout
                        area.spellcheck = false;

                        // Unlock audio on first interaction
                        area.addEventListener('focus', unlockAudio, { once: true });
                        area.addEventListener('touchstart', unlockAudio, { once: true });

                        // Re-attach listeners to the new active textarea
                        area.addEventListener('keydown', handleKeydown);

                        // Add input listener for mobile virtual keyboards
                        area.addEventListener('input', handleInput);

                        // Track the previous value for mobile input detection
                        area.addEventListener('focus', () => {
                            previousTextareaValue = area.value;
                        });

                        activeTextarea = area;

                        editorContainer.appendChild(metaLine);
                        editorContainer.appendChild(area);
                        mainContent.appendChild(header);
                        mainContent.appendChild(editorContainer);

                        appContainer.appendChild(sidebar);
                        appContainer.appendChild(mainContent);
                        card.appendChild(appContainer);

                        // Character Count Overlay (Bottom Right of Editor)
                        const count = document.createElement('div');
                        count.className = `absolute bottom-4 right-6 text-[10px] font-mono opacity-30 pointer-events-none`;
                        count.style.color = theme.text;
                        count.innerHTML = '<span id="char-count">0</span> words';
                        editorContainer.appendChild(count); // Append to editor container now

                        area.addEventListener('input', (e) => {
                            // Simple rough word count
                            const words = e.target.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                            count.querySelector('span').textContent = words;
                        });

                    } else {
                        // Side Cards - Simple Preview
                        // Just the container background is set above.
                        // We can add a simple "Sidebar" block to distinguish it visually

                        const simpleSidebar = document.createElement('div');
                        simpleSidebar.className = "absolute left-0 top-0 bottom-0 w-1/4 opacity-30";
                        simpleSidebar.style.backgroundColor = theme.surface;
                        simpleSidebar.style.borderRight = `1px solid ${theme.border}`;
                        card.appendChild(simpleSidebar);

                        const previewText = document.createElement('div');
                        previewText.className = `absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center ${theme.font} text-3xl font-bold opacity-40 select-none`;
                        previewText.textContent = theme.name;
                        previewText.style.color = theme.text;
                        card.appendChild(previewText);
                    }

                    track.appendChild(card);
                };

                createCard(prevIndex, 'left');
                createCard(currentIndex, 'center');
                createCard(nextIndex, 'right');

                themeNameDisplay.textContent = themes[currentIndex].name;
            }

            // --- Sound Manager ---
            // Uses global SOUND_MANIFEST from assets/sound_manifest.js

            const handleKeydown = (e) => {
                const type = e.key === 'Enter' ? 'enter' : (e.key === ' ' ? 'space' : 'standard');
                if (e.key.length === 1 || type !== 'standard') playSound(type);
            };

            // Handle input events for mobile virtual keyboards
            const handleInput = (e) => {
                if (!isMobile) return; // Only use on mobile

                const currentValue = e.target.value;
                const diff = currentValue.length - previousTextareaValue.length;

                if (diff > 0) {
                    // Character(s) added
                    const addedChars = currentValue.slice(previousTextareaValue.length);
                    for (let char of addedChars) {
                        if (char === '\n') {
                            playSound('enter');
                        } else if (char === ' ') {
                            playSound('space');
                        } else {
                            playSound('standard');
                        }
                    }
                }

                previousTextareaValue = currentValue;
            };

            const playSound = (type) => {
                if (!audioUnlocked) {
                    unlockAudio();
                    return; // Don't play this time, will work next time
                }

                const pack = soundSelect.value;

                // Fallback if manifest is missing
                const config = (typeof SOUND_MANIFEST !== 'undefined' && SOUND_MANIFEST[pack]) ? SOUND_MANIFEST[pack] : null;

                if (!config) {
                    console.warn(`Sound pack ${pack} not found in manifest.`);
                    return;
                }

                // Use pre-loaded audio pool
                let audioArray = null;

                if (type === 'space' && config.space_count > 0) {
                    audioArray = audioPool[pack]?.space;
                } else if (type === 'enter' && config.enter_count > 0) {
                    audioArray = audioPool[pack]?.enter;
                } else if (config.standard_count > 0) {
                    audioArray = audioPool[pack]?.standard;
                }

                // Fallback to creating new audio if pool doesn't exist
                if (!audioArray || audioArray.length === 0) {
                    let filename = '';
                    const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];

                    if (type === 'space' && config.space_count > 0) {
                        filename = getRandom(config.space);
                    } else if (type === 'enter' && config.enter_count > 0) {
                        filename = getRandom(config.enter);
                    } else if (config.standard_count > 0) {
                        filename = getRandom(config.standard);
                    } else {
                        return;
                    }

                    const audio = new Audio(`assets/sounds/${pack}/${filename}`);
                    audio.volume = 0.5;
                    audio.play().catch(e => console.warn('Audio playback failed:', e));
                    return;
                }

                // Find an available audio element from pool
                const availableAudio = audioArray.find(a => a.paused || a.ended) || audioArray[0];

                if (availableAudio) {
                    availableAudio.currentTime = 0; // Reset to start
                    availableAudio.play().catch(e => console.warn('Audio playback failed:', e));
                }
            };

            // Controls
            document.getElementById('prev-theme').addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + themes.length) % themes.length;
                renderCarousel();
            });

            document.getElementById('next-theme').addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % themes.length;
                renderCarousel();
            });

            // Sound pack selector change
            soundSelect.addEventListener('change', () => {
                if (audioUnlocked) {
                    preloadAllSounds();
                }
            });

            // Initialize on load
            renderCarousel();
            updateAudioIndicator(false); // Start with indicator showing audio not ready

            // Try to unlock audio on any user interaction with the page
            const globalUnlock = () => {
                unlockAudio();
                document.removeEventListener('click', globalUnlock);
                document.removeEventListener('touchstart', globalUnlock);
            };
            document.addEventListener('click', globalUnlock);
            document.addEventListener('touchstart', globalUnlock);
        });
    </script>

    <!-- Footer / Why Section -->
    <footer class="py-20 relative overflow-hidden">
        <div class="container mx-auto px-4 text-center relative z-10">
            <div class="max-w-2xl mx-auto mb-16">
                <i class="fa-solid fa-quote-left text-4xl text-novellium-cyan opacity-30 mb-6"></i>
                <p class="font-serif text-lg md:text-xl leading-relaxed text-gray-300 mb-6">
                    "Built for writers, not shareholders. No subscriptions, no data harvesting. Just a tool to help you
                    finish your book."
                </p>
                <div class="font-display font-bold text-gray-500 uppercase tracking-widest text-sm">— The Developer
                </div>
            </div>

            <a href="releases/Novellium.exe"
                class="inline-flex items-center gap-3 px-8 py-4 bg-transparent border border-novellium-cyan text-novellium-cyan font-display font-bold text-lg rounded-full hover:bg-novellium-cyan hover:text-black transition-all shadow-glow-cyan">
                <span>Start Writing</span>
                <i class="fa-solid fa-arrow-right"></i>
            </a>

            <div class="mt-16 text-gray-600 text-sm">
                <p>&copy; 2026 Novellium. Forever Free.</p>
                <div class="flex justify-center gap-6 mt-4">
                    <a href="#" class="hover:text-novellium-cyan transition-colors"><i
                            class="fa-brands fa-github text-xl"></i></a>
                    <a href="#" class="hover:text-novellium-cyan transition-colors"><i
                            class="fa-brands fa-discord text-xl"></i></a>
                    <a href="#" class="hover:text-novellium-cyan transition-colors"><i
                            class="fa-brands fa-twitter text-xl"></i></a>
                </div>
            </div>
        </div>

        <!-- Footer Background Glow -->
        <div
            class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-4xl h-64 bg-novellium-cyan/5 filter blur-[100px] pointer-events-none rounded-t-full">
        </div>
    </footer>

</body>

</html>
